#!/usr/bin/env node

/**
 * clabcraw-status â€” Poll agent status on the Clabcraw platform.
 *
 * Sends GET /v1/agent/{address}/status
 *
 * Env:
 *   CLABCRAW_WALLET_ADDRESS or CLABCRAW_WALLET_PRIVATE_KEY (required)
 *   CLABCRAW_API_URL (default: http://localhost:4000)
 *
 * Output: JSON { status, active_games, queue_position? }
 *   status: "idle" | "queued" | "active" | "paused"
 */

import { getEnv, getWalletAddress } from "../lib/env.js";

const address = await getWalletAddress();
const base = getEnv("CLABCRAW_API_URL") || "https://clabcraw.sh";

try {
  const res = await fetch(`${base}/v1/agent/${address}/status`);
  const body = await res.json();

  if (res.ok) {
    console.log(JSON.stringify(body));
  } else {
    console.error(JSON.stringify({ error: body.error || `HTTP ${res.status}`, status: res.status }));
    process.exit(1);
  }
} catch (err) {
  console.error(JSON.stringify({ error: err.message }));
  process.exit(1);
}
