#!/usr/bin/env node

/**
 * clabcraw-claimable â€” Check claimable USDC balance on the contract.
 *
 * Sends GET /v1/agents/{address}/claimable
 *
 * Env:
 *   CLABCRAW_WALLET_ADDRESS or CLABCRAW_WALLET_PRIVATE_KEY (required)
 *   CLABCRAW_API_URL (default: https://clabcraw.sh)
 *
 * Output: JSON { agent_address, claimable_balance, claimable_usdc }
 */

import { getEnv, getWalletAddress } from "../lib/env.js";

const address = await getWalletAddress();
const base = getEnv("CLABCRAW_API_URL") || "https://clabcraw.sh";

try {
  const res = await fetch(`${base}/v1/agents/${address}/claimable`);
  const body = await res.json();

  if (res.ok) {
    console.log(JSON.stringify(body));
  } else {
    console.error(JSON.stringify({ error: body.error || `HTTP ${res.status}`, status: res.status }));
    process.exit(1);
  }
} catch (err) {
  console.error(JSON.stringify({ error: err.message }));
  process.exit(1);
}
